## TaskManager

TaskManager — это планировщик задач с использованием потоков. Задачи выполняются асинхронно в отдельном потоке, не блокируя основной поток программы.    
Это достигается благодаря применению `std::thread`, `std::mutex`, и `std::condition_variable`.

Выполнено в рамках профильного задания на стажировку VK.

---

## Содержание
- [Описание решения](#описание-решения)
- [Архитектура](#архитектура)
- [Установка и сборка](#установка-и-сборка)
- [Технические детали](#технические-детали)
- [TODO](#todo)

---

## Описание решения
Реализован класс для управления и выполнения задач с использованием потоков и примитивов синхронизации.     
Методы класса: `Add`, `eraseTask`, `startThread`.

**метод `Add`**
- **входные параметры**: `std::function<void()> task`, `std::time_t timestamp`
- **описание**: Добавляет задачу в контейнер с задачами и возобновляет поток, если он был приостановлен

**метод `eraseTask`**
- **Входные параметры**: `int id`
- **Описание**: Удаляет задачу по ее идентификатору из контейнера задач

**вспомогательный метод `startThread`**
- **Описание**: Инициализирует поток, который проверяет, есть ли задачи в очереди и выполняет их в указанное время. При их отсутствии поток засыпает до тех пор, пока не поступит сигнал об обновлении списка задач

---

## Архитектура
1. **TaskManager**:
    - хранит задачи в `unordered_map`, где ключом служит идентификатор задачи
    - использует поток для отслеживания времени выполнения задач
    - управляет синхронизацией с помощью мьютекса и условной переменной


2. **Асинхронное выполнение**:
    - задачи запускаются с использованием `std::thread` и `detach()` для обеспечения асинхронности
    - основной поток проверки задач не блокируется выполнением задач

---

## Установка и сборка
1. Для сборки и запуска проекта должен быть установлен CMake.
2. Склонировать репозиторий:
   ```
   git clone https://github.com/neklyudovv/vkttc.git
   ```
3. Перейти в директорию проекта:
   ```
   cd vkttc
   ```
4. Создать папку сборки и собрать проект:
   ```
   mkdir build && cd build
   cmake ..
   make
   ```


---

## Технические детали
- **потоковая модель**:
    - основной поток `TaskManager` выполняет цикл с ожиданием появления новых задач и приостанавливает свою работу при их отсутствии
    - при совпадении `timestamp` и текущего времени задача запускается в отдельном потоке
- **синхронизация**:
    - используется `std::mutex` для защиты контейнера с задачами, контроля доступа к методам `Add` и `eraseTask` и избежания гонки данных
    - `std::condition_variable` используется для пробуждения потока при добавлении новой задачи

---

## TODO
- заменить `std::unordered_map` на `std::map`, добавить сортировку задач по времени исполнения
- оптимизировать работу при помощи `std::condition_variable::wait_until()`
- добавить обработчик ошибок, в том числе при вызове методов с неправильными аргументами (напр. уже прошедший `timestamp`)
- провести нагрузочное тестирование для оценки производительности при большом количестве задач
